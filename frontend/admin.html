<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öîÔ∏è Command Center - Gaming Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.7.0/flowbite.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Brgy Tamago Official Brand Colors
                        'brand-gold': '#fdbd16',        // Primary Gold/Yellow
                        'brand-red': '#f22524',         // Primary Red
                        'brand-black': '#1f1f20',       // Dark Background
                        'brand-white': '#ffffff',       // White
                        'brand-beige': '#e3c293',       // Tan/Beige accent
                        'brand-orange': '#ef6d1f',      // Orange accent
                        'brand-gray': '#585858',        // Gray
                        
                        // Derived shades for UI
                        'brand-gold-light': '#ffd03a',  // Lighter gold
                        'brand-gold-dark': '#e5aa00',   // Darker gold
                        'brand-gray-light': '#6E6E6E',  // Lighter gray
                        'brand-gray-dark': '#3A3A3A',   // Darker gray
                        'brand-red-light': '#ff4447',   // Lighter red
                        'brand-red-dark': '#d01619',    // Darker red
                        
                        // Legacy gaming colors (mapped to new colors)
                        'gaming-dark': '#1f1f20',       // Now uses brand-black
                        'neon-blue': '#fdbd16',         // Now uses brand-gold
                        'neon-purple': '#f22524',       // Now uses brand-red
                        'neon-pink': '#FF4447',         // Light red variant
                        'neon-green': '#FEBD11',        // Gold for success
                        'neon-yellow': '#FFCF3A',       // Light gold
                    },
                    fontFamily: {
                        'gaming': ['Orbitron', 'sans-serif'],
                        'body': ['Rajdhani', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Brand Color Glow Animations */
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(254, 189, 17, 0.5), 0 0 20px rgba(243, 30, 33, 0.3); }
            50% { box-shadow: 0 0 20px rgba(254, 189, 17, 0.8), 0 0 40px rgba(243, 30, 33, 0.5); }
        }
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        /* Typography */
        .gaming-title { font-family: 'Orbitron', sans-serif; }
        .gaming-body { font-family: 'Rajdhani', sans-serif; }
        
        /* Brand Gradient Text - Gold to Red */
        .gradient-text { 
            background: linear-gradient(135deg, #FEBD11, #F31E21, #FEBD11); 
            background-size: 200% auto;
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            background-clip: text;
            animation: shimmer 3s linear infinite;
        }
        
        /* Brand Gradients for Backgrounds */
        .gradient-gold-red {
            background: linear-gradient(135deg, #FEBD11 0%, #F31E21 100%);
        }
        .gradient-black-gray {
            background: linear-gradient(135deg, #202020 0%, #585858 100%);
        }
        .gradient-gold-light {
            background: linear-gradient(135deg, #FEBD11 0%, #FFCF3A 100%);
        }
        .card-glow { animation: glow 3s infinite; }
        .slide-in { animation: slideIn 0.5s ease-out; }
        .admin-bg {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0a0e27 100%);
            position: relative;
            min-height: 100vh;
        }
        .admin-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: pulse-glow 4s infinite;
            pointer-events: none;
        }
        .table-row:hover {
            background: rgba(0, 212, 255, 0.1);
            transform: scale(1.01);
            transition: all 0.2s;
        }
    </style>
</head>
<body class="gaming-body admin-bg text-white">
    
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-gradient-to-br from-gaming-dark/95 to-purple-900/40 backdrop-blur-lg rounded-2xl border-2 border-neon-blue/30 p-8 w-full max-w-md card-glow slide-in">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4 animate-pulse">‚öîÔ∏è</div>
                <h2 class="text-4xl font-black gaming-title gradient-text mb-2">COMMAND CENTER</h2>
                <p class="text-gray-400 gaming-body text-lg">Admin Access Required</p>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-bold text-neon-blue mb-2 gaming-title">USERNAME</label>
                <input id="loginUsername" class="w-full bg-black/50 border-2 border-neon-blue/30 focus:border-neon-purple rounded-xl px-4 py-3 text-white placeholder-gray-500 gaming-body focus:outline-none transition-all focus:shadow-lg focus:shadow-neon-blue/30" type="text" placeholder="Enter admin username">
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-bold text-neon-pink mb-2 gaming-title">PASSWORD</label>
                <input id="loginPassword" class="w-full bg-black/50 border-2 border-neon-pink/30 focus:border-neon-purple rounded-xl px-4 py-3 text-white placeholder-gray-500 gaming-body focus:outline-none transition-all focus:shadow-lg focus:shadow-neon-pink/30" type="password" placeholder="Enter admin password">
            </div>
            
            <!-- Server Status Indicator -->
            <div class="mb-6 bg-black/30 border border-brand-gold/30 rounded-xl p-4">
                <div class="text-xs font-bold text-brand-gold mb-3 gaming-title flex items-center gap-2">
                    <span class="animate-pulse">‚ö°</span> SERVERS STATUS
                </div>
                <div class="space-y-2 text-xs gaming-body">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Frontend Server:</span>
                        <span id="frontendStatus" class="flex items-center gap-1">
                            <span class="animate-pulse">üîÑ</span> 
                            <span class="text-gray-500">Checking...</span>
                        </span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">API Server:</span>
                        <span id="apiStatus" class="flex items-center gap-1">
                            <span class="animate-pulse">üîÑ</span> 
                            <span class="text-gray-500">Checking...</span>
                        </span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Database:</span>
                        <span id="databaseStatus" class="flex items-center gap-1">
                            <span class="animate-pulse">üîÑ</span> 
                            <span class="text-gray-500">Checking...</span>
                        </span>
                    </div>
                </div>
            </div>
            
            <button class="w-full py-4 bg-gradient-to-r from-neon-blue to-neon-purple hover:from-neon-purple hover:to-neon-pink rounded-xl font-bold gaming-title text-lg transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-neon-purple/50" onclick="login()">
                üöÄ ACCESS COMMAND CENTER
            </button>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <!-- Top Navigation -->
        <nav class="bg-gaming-dark/80 backdrop-blur-lg border-b-2 border-neon-blue/20 sticky top-0 z-50">
            <div class="container mx-auto px-2 sm:px-4 py-3 sm:py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2 sm:gap-4">
                        <span class="text-2xl sm:text-3xl">‚öîÔ∏è</span>
                        <div>
                            <h1 class="text-lg sm:text-2xl font-black gaming-title gradient-text">COMMAND CENTER</h1>
                            <p class="text-xs text-gray-400 hidden sm:block">Gaming Community Admin</p>
                        </div>
                    </div>
                    <button onclick="logout()" class="px-3 sm:px-4 py-2 bg-red-900/50 hover:bg-red-800 border border-red-500/50 rounded-lg gaming-title text-xs sm:text-sm transition-all hover:scale-105">
                        <span class="hidden sm:inline">üö™ LOGOUT</span>
                        <span class="sm:hidden">üö™</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mx-auto px-2 sm:px-4 py-4 sm:py-8">
            
            <!-- Navigation Tabs -->
            <div class="mb-6 sm:mb-8 flex flex-wrap gap-2">
                <button onclick="showSection('dashboard')" class="tab-btn px-3 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-neon-blue/20 to-neon-purple/20 border-2 border-neon-blue/50 rounded-xl gaming-title text-xs sm:text-sm font-bold hover:scale-105 transition-all" data-section="dashboard">
                    <span class="hidden sm:inline">üìä DASHBOARD</span>
                    <span class="sm:hidden">üìä</span>
                </button>
                <button onclick="showSection('users')" class="tab-btn px-3 sm:px-6 py-2 sm:py-3 bg-gaming-dark/50 border-2 border-gray-700 rounded-xl gaming-title text-xs sm:text-sm font-bold hover:border-neon-purple/50 hover:scale-105 transition-all" data-section="users">
                    <span class="hidden sm:inline">üë• PLAYERS</span>
                    <span class="sm:hidden">üë•</span>
                </button>
                <button onclick="showSection('tasks')" class="tab-btn px-3 sm:px-6 py-2 sm:py-3 bg-gaming-dark/50 border-2 border-gray-700 rounded-xl gaming-title text-xs sm:text-sm font-bold hover:border-neon-purple/50 hover:scale-105 transition-all" data-section="tasks">
                    <span class="hidden sm:inline">‚öîÔ∏è QUESTS</span>
                    <span class="sm:hidden">‚öîÔ∏è</span>
                </button>
                <button onclick="showSection('rewards')" class="tab-btn px-3 sm:px-6 py-2 sm:py-3 bg-gaming-dark/50 border-2 border-gray-700 rounded-xl gaming-title text-xs sm:text-sm font-bold hover:border-neon-purple/50 hover:scale-105 transition-all" data-section="rewards">
                    <span class="hidden sm:inline">üíé LOOT</span>
                    <span class="sm:hidden">üíé</span>
                </button>
                <button onclick="showSection('verification')" class="tab-btn px-3 sm:px-6 py-2 sm:py-3 bg-gaming-dark/50 border-2 border-gray-700 rounded-xl gaming-title text-xs sm:text-sm font-bold hover:border-neon-purple/50 hover:scale-105 transition-all" data-section="verification">
                    <span class="hidden sm:inline">‚úì VERIFICATION</span>
                    <span class="sm:hidden">‚úì</span>
                </button>
            </div>

            <!-- Server Status Panel (Dashboard) -->
            <div class="mb-6 bg-gradient-to-br from-gaming-dark/90 to-purple-900/20 border-2 border-brand-gold/30 rounded-2xl p-6 card-glow">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <span class="text-3xl animate-pulse">‚ö°</span>
                        <h3 class="text-xl sm:text-2xl font-black gaming-title text-brand-gold">SERVERS STATUS</h3>
                    </div>
                    <div class="text-xs text-gray-500 gaming-body">
                        Auto-refresh: 30s
                    </div>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Frontend Server -->
                    <div class="bg-black/30 border border-brand-gold/20 rounded-xl p-4">
                        <div class="text-xs text-gray-400 mb-2 gaming-body">Frontend Server</div>
                        <div id="dashboardFrontendStatus" class="flex items-center gap-2">
                            <span class="animate-pulse">üîÑ</span>
                            <div>
                                <div class="text-sm font-bold gaming-title text-gray-500">Checking...</div>
                                <div class="text-xs text-gray-600">Port 8080</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- API Server -->
                    <div class="bg-black/30 border border-brand-gold/20 rounded-xl p-4">
                        <div class="text-xs text-gray-400 mb-2 gaming-body">API Server</div>
                        <div id="dashboardApiStatus" class="flex items-center gap-2">
                            <span class="animate-pulse">üîÑ</span>
                            <div>
                                <div class="text-sm font-bold gaming-title text-gray-500">Checking...</div>
                                <div class="text-xs text-gray-600">Port 8000</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Database -->
                    <div class="bg-black/30 border border-brand-gold/20 rounded-xl p-4">
                        <div class="text-xs text-gray-400 mb-2 gaming-body">Database</div>
                        <div id="dashboardDatabaseStatus" class="flex items-center gap-2">
                            <span class="animate-pulse">üîÑ</span>
                            <div>
                                <div class="text-sm font-bold gaming-title text-gray-500">Checking...</div>
                                <div class="text-xs text-gray-600">PostgreSQL</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Auto-reload -->
                    <div class="bg-black/30 border border-brand-gold/20 rounded-xl p-4">
                        <div class="text-xs text-gray-400 mb-2 gaming-body">Auto-reload</div>
                        <div class="flex items-center gap-2">
                            <span class="text-green-400">‚úÖ</span>
                            <div>
                                <div class="text-sm font-bold gaming-title text-green-400">ENABLED</div>
                                <div class="text-xs text-gray-600">Code Changes</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section">
                <div class="bg-gaming-dark/60 border-2 border-neon-blue/20 rounded-2xl p-6">
                    <h2 class="text-2xl font-black gaming-title gradient-text mb-6">üì° ADMIN DASHBOARD</h2>
                    <div class="text-center text-gray-400 py-12">
                        <p class="text-lg mb-2">üéÆ Welcome to the Admin Control Panel</p>
                        <p class="text-sm">Use the menu to manage users, quests, and rewards.</p>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users" class="content-section hidden">
                <div class="bg-gaming-dark/60 border-2 border-neon-blue/20 rounded-2xl p-3 sm:p-6">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 sm:mb-6 gap-2">
                        <h2 class="text-xl sm:text-2xl font-black gaming-title gradient-text">üë• PLAYER MANAGEMENT</h2>
                        <div class="text-xs sm:text-sm text-gray-400 gaming-body">Total Players: <span id="userCount" class="text-neon-blue font-bold">0</span></div>
                    </div>
                    
                    <!-- Desktop Table -->
                    <div class="hidden lg:block overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b-2 border-neon-blue/20">
                                    <th class="px-4 py-3 text-left text-neon-blue gaming-title text-sm">PLAYER</th>
                                    <th class="px-4 py-3 text-left text-neon-blue gaming-title text-sm">USERNAME</th>
                                    <th class="px-4 py-3 text-left text-neon-blue gaming-title text-sm">LEVEL</th>
                                    <th class="px-4 py-3 text-left text-neon-blue gaming-title text-sm">XP</th>
                                    <th class="px-4 py-3 text-left text-neon-blue gaming-title text-sm">EARNED</th>
                                    <th class="px-4 py-3 text-left text-neon-blue gaming-title text-sm">STATUS</th>
                                    <th class="px-4 py-3 text-left text-neon-blue gaming-title text-sm">ACTIONS</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable" class="divide-y divide-gray-800">
                                <tr><td colspan="7" class="text-center py-12 text-gray-500">Loading players...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Mobile Card View -->
                    <div id="usersCards" class="lg:hidden space-y-3">
                        <div class="text-center py-8 text-gray-500">Loading players...</div>
                    </div>
                </div>
            </section>

            <!-- Tasks Section -->
            <section id="tasks" class="content-section hidden">
                <div class="bg-gaming-dark/60 border-2 border-neon-purple/20 rounded-2xl p-3 sm:p-6">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 sm:mb-6 gap-3">
                        <h2 class="text-xl sm:text-2xl font-black gaming-title gradient-text">‚öîÔ∏è QUEST MANAGEMENT</h2>
                        <button onclick="window.location.href='/quest-select.html'" class="w-full sm:w-auto px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-brand-gold to-brand-red hover:scale-105 rounded-xl gaming-title text-sm sm:text-base font-bold transition-all shadow-lg">
                            ‚ûï CREATE QUEST
                        </button>
                    </div>
                    
                    <!-- Desktop Table View -->
                    <div class="hidden lg:block overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b-2 border-neon-purple/20">
                                    <th class="px-4 py-3 text-left text-neon-purple gaming-title text-sm">QUEST</th>
                                    <th class="px-4 py-3 text-left text-neon-purple gaming-title text-sm">TYPE</th>
                                    <th class="px-4 py-3 text-left text-neon-purple gaming-title text-sm">PLATFORM</th>
                                    <th class="px-4 py-3 text-left text-neon-purple gaming-title text-sm">XP REWARD</th>
                                    <th class="px-4 py-3 text-left text-neon-purple gaming-title text-sm">RARITY</th>
                                    <th class="px-4 py-3 text-left text-neon-purple gaming-title text-sm">STATUS</th>
                                    <th class="px-4 py-3 text-left text-neon-purple gaming-title text-sm">ACTIONS</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTable" class="divide-y divide-gray-800">
                                <tr><td colspan="7" class="text-center py-12 text-gray-500">Loading quests...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Mobile Card View -->
                    <div id="tasksCards" class="lg:hidden space-y-3">
                        <div class="text-center py-8 text-gray-500">Loading quests...</div>
                    </div>
                </div>
            </section>

            <!-- Rewards Section -->
            <section id="rewards" class="content-section hidden">
                <div class="bg-gaming-dark/60 border-2 border-neon-pink/20 rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-black gaming-title gradient-text">üíé LOOT MANAGEMENT</h2>
                        <button onclick="showAddRewardModal()" class="px-6 py-3 bg-gradient-to-r from-neon-purple to-neon-pink hover:from-neon-pink hover:to-neon-yellow rounded-xl gaming-title font-bold transition-all hover:scale-105 hover:shadow-lg hover:shadow-neon-pink/50">
                            ‚ûï ADD LOOT
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b-2 border-neon-pink/20">
                                    <th class="px-4 py-3 text-left text-neon-pink gaming-title text-sm">LOOT</th>
                                    <th class="px-4 py-3 text-left text-neon-pink gaming-title text-sm">TYPE</th>
                                    <th class="px-4 py-3 text-left text-neon-pink gaming-title text-sm">XP COST</th>
                                    <th class="px-4 py-3 text-left text-neon-pink gaming-title text-sm">STOCK</th>
                                    <th class="px-4 py-3 text-left text-neon-pink gaming-title text-sm">CLAIMED</th>
                                    <th class="px-4 py-3 text-left text-neon-pink gaming-title text-sm">STATUS</th>
                                    <th class="px-4 py-3 text-left text-neon-pink gaming-title text-sm">ACTIONS</th>
                                </tr>
                            </thead>
                            <tbody id="rewardsTable" class="divide-y divide-gray-800">
                                <tr><td colspan="7" class="text-center py-12 text-gray-500">Loading loot...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Verification Section -->
            <section id="verification" class="content-section hidden">
                <div class="bg-gaming-dark/60 border-2 border-neon-green/20 rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-black gaming-title gradient-text">‚úì MISSION CONTROL - VERIFICATION QUEUE</h2>
                        <div class="text-sm text-gray-400 gaming-body">Pending: <span id="verificationCount" class="text-neon-yellow font-bold">0</span></div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b-2 border-neon-green/20">
                                    <th class="px-4 py-3 text-left text-neon-green gaming-title text-sm">PLAYER</th>
                                    <th class="px-4 py-3 text-left text-neon-green gaming-title text-sm">QUEST</th>
                                    <th class="px-4 py-3 text-left text-neon-green gaming-title text-sm">XP REWARD</th>
                                    <th class="px-4 py-3 text-left text-neon-green gaming-title text-sm">PROOF</th>
                                    <th class="px-4 py-3 text-left text-neon-green gaming-title text-sm">SUBMITTED</th>
                                    <th class="px-4 py-3 text-left text-neon-green gaming-title text-sm">ACTIONS</th>
                                </tr>
                            </thead>
                            <tbody id="verificationTable" class="divide-y divide-gray-800">
                                <tr><td colspan="6" class="text-center py-12 text-gray-500">No pending verifications</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-gaming-dark to-purple-900/40 border-2 border-neon-purple/50 rounded-2xl p-8 w-full max-w-3xl card-glow max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-black gaming-title gradient-text">‚öîÔ∏è CREATE NEW QUEST</h2>
                <button onclick="closeModal('taskModal')" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            
            <form id="taskForm" onsubmit="submitTask(event)" class="space-y-4">
                <!-- Step 1: Choose Quest Type -->
                <div class="mb-6">
                    <label class="block text-neon-blue gaming-title text-sm mb-3">SELECT QUEST TYPE</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                        <button type="button" onclick="selectQuestType('twitter')" class="quest-type-btn border-2 border-neon-blue/30 hover:border-neon-blue bg-black/50 rounded-xl p-4 text-center transition-all hover:scale-105" data-type="twitter">
                            <div class="text-3xl mb-2">üê¶</div>
                            <div class="text-sm gaming-title">Twitter</div>
                        </button>
                        <button type="button" onclick="selectQuestType('youtube')" class="quest-type-btn border-2 border-neon-blue/30 hover:border-neon-blue bg-black/50 rounded-xl p-4 text-center transition-all hover:scale-105" data-type="youtube">
                            <div class="text-3xl mb-2">üì∫</div>
                            <div class="text-sm gaming-title">YouTube</div>
                        </button>
                        <button type="button" onclick="selectQuestType('telegram')" class="quest-type-btn border-2 border-neon-blue/30 hover:border-neon-blue bg-black/50 rounded-xl p-4 text-center transition-all hover:scale-105" data-type="telegram">
                            <div class="text-3xl mb-2">‚úàÔ∏è</div>
                            <div class="text-sm gaming-title">Telegram</div>
                        </button>
                        <button type="button" onclick="selectQuestType('daily')" class="quest-type-btn border-2 border-neon-blue/30 hover:border-neon-blue bg-black/50 rounded-xl p-4 text-center transition-all hover:scale-105" data-type="daily">
                            <div class="text-3xl mb-2">üìÖ</div>
                            <div class="text-sm gaming-title">Daily Check-in</div>
                        </button>
                        <button type="button" onclick="selectQuestType('manual')" class="quest-type-btn border-2 border-neon-blue/30 hover:border-neon-blue bg-black/50 rounded-xl p-4 text-center transition-all hover:scale-105" data-type="manual">
                            <div class="text-3xl mb-2">‚úçÔ∏è</div>
                            <div class="text-sm gaming-title">Manual</div>
                        </button>
                    </div>
                </div>

                <!-- Common Fields -->
                <div class="space-y-4 common-fields" style="display: none;">
                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">QUEST TITLE</label>
                        <input id="taskTitle" type="text" required class="w-full bg-black/50 border-2 border-neon-blue/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                    </div>
                    
                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">DESCRIPTION</label>
                        <textarea id="taskDescription" rows="3" required class="w-full bg-black/50 border-2 border-neon-blue/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple"></textarea>
                    </div>

                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">XP REWARD</label>
                        <input id="taskPoints" type="number" required min="1" value="50" class="w-full bg-black/50 border-2 border-neon-blue/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                    </div>
                </div>

                <!-- Twitter Specific Fields -->
                <div id="twitterFields" class="hidden border-2 border-neon-blue/30 rounded-xl p-5 bg-blue-900/20 space-y-4">
                    <h3 class="text-lg font-bold gaming-title text-neon-blue mb-3">üê¶ Twitter Quest Configuration</h3>
                    
                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">ACTION TYPE</label>
                        <select id="twitterActionType" class="w-full bg-black/50 border-2 border-neon-blue/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                            <option value="follow">Follow Account</option>
                            <option value="like">Like Tweet</option>
                            <option value="retweet">Retweet</option>
                            <option value="reply">Reply to Tweet</option>
                        </select>
                    </div>

                    <div id="twitterUsernameField">
                        <label class="block text-neon-blue gaming-title text-sm mb-2">TARGET USERNAME (without @)</label>
                        <input id="twitterUsername" type="text" placeholder="username" class="w-full bg-black/50 border-2 border-neon-blue/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                        <p class="text-xs text-gray-400 mt-1">Example: elonmusk</p>
                    </div>

                    <div id="twitterTweetField" class="hidden">
                        <label class="block text-neon-blue gaming-title text-sm mb-2">TWEET URL</label>
                        <input id="twitterTweetUrl" type="url" placeholder="https://twitter.com/username/status/123456" class="w-full bg-black/50 border-2 border-neon-blue/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                    </div>

                    <div class="p-3 bg-neon-blue/10 border border-neon-blue/30 rounded-lg">
                        <p class="text-sm text-gray-300">
                            ‚ö° <strong>Auto-Verification:</strong> Uses Twitter API to verify completion (Rate limited: 100 checks/day)
                        </p>
                    </div>
                </div>

                <!-- Telegram Specific Fields -->
                <div id="telegramFields" class="hidden border-2 border-cyan-500/30 rounded-xl p-5 bg-cyan-900/20 space-y-4">
                    <h3 class="text-lg font-bold gaming-title text-cyan-400 mb-3">‚úàÔ∏è Telegram Quest Configuration</h3>
                    
                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">ACTION TYPE</label>
                        <select id="telegramActionType" class="w-full bg-black/50 border-2 border-cyan-500/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                            <option value="join_group">Join Group/Supergroup</option>
                            <option value="join_channel">Subscribe to Channel</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">TELEGRAM LINK</label>
                        <input id="telegramLink" type="url" placeholder="https://t.me/yourgroupname or @yourgroupname" class="w-full bg-black/50 border-2 border-cyan-500/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                        <p class="text-xs text-gray-400 mt-1">Example: https://t.me/mychannel or @mychannel</p>
                    </div>

                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">GROUP/CHANNEL ID</label>
                        <input id="telegramChatId" type="text" placeholder="-1001234567890 or @channelname" class="w-full bg-black/50 border-2 border-cyan-500/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                        <p class="text-xs text-gray-400 mt-1">Numeric ID (e.g., -1001234567890) or username (e.g., @mychannel)</p>
                    </div>

                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">GROUP/CHANNEL NAME</label>
                        <input id="telegramChatName" type="text" placeholder="My Awesome Channel" class="w-full bg-black/50 border-2 border-cyan-500/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                        <p class="text-xs text-gray-400 mt-1">Display name for users</p>
                    </div>

                    <div class="p-3 bg-cyan-500/10 border border-cyan-500/30 rounded-lg">
                        <p class="text-sm text-gray-300">
                            ‚ö° <strong>Auto-Verification:</strong> Bot checks if user is a member of the specified group/channel
                        </p>
                        <p class="text-xs text-gray-400 mt-2">
                            ‚ö†Ô∏è <strong>Requirements:</strong>
                            <br>‚Ä¢ Bot must be admin in the group/channel
                            <br>‚Ä¢ Group/channel must be public or bot must have access
                            <br>‚Ä¢ Bot needs permission to see member list
                        </p>
                    </div>
                </div>

                <!-- YouTube Specific Fields -->
                <div id="youtubeFields" class="hidden border-2 border-red-500/30 rounded-xl p-5 bg-red-900/20 space-y-4">
                    <h3 class="text-lg font-bold gaming-title text-red-400 mb-3">üì∫ YouTube Video Quest</h3>
                    
                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">YOUTUBE VIDEO URL</label>
                        <input id="youtubeUrl" type="url" placeholder="https://youtube.com/watch?v=..." class="w-full bg-black/50 border-2 border-red-500/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                    </div>

                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">SECRET CODE (shown in video)</label>
                        <input id="youtubeSecretCode" type="text" placeholder="e.g., QUEST2025" class="w-full bg-black/50 border-2 border-red-500/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                        <p class="text-xs text-gray-400 mt-1">Users must enter this code after watching</p>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-neon-blue gaming-title text-sm mb-2">MIN. WATCH TIME (seconds)</label>
                            <input id="youtubeMinWatchTime" type="number" value="120" min="30" max="3600" class="w-full bg-black/50 border-2 border-red-500/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                        </div>
                        
                        <div>
                            <label class="block text-neon-blue gaming-title text-sm mb-2">MAX ATTEMPTS</label>
                            <input id="youtubeMaxAttempts" type="number" value="3" min="1" max="10" class="w-full bg-black/50 border-2 border-red-500/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                        </div>
                    </div>

                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">CODE APPEARS AT</label>
                        <input id="youtubeCodeHint" type="text" placeholder="e.g., 2:30 or at the end" value="during the video" class="w-full bg-black/50 border-2 border-red-500/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                    </div>

                    <div class="p-3 bg-red-500/10 border border-red-500/30 rounded-lg">
                        <p class="text-sm text-gray-300">
                            ‚ö° <strong>How it works:</strong> User watches video, enters code shown in video. Watch time is tracked.
                        </p>
                    </div>
                </div>

                <!-- Daily Check-in Fields -->
                <div id="dailyFields" class="hidden border-2 border-neon-green/30 rounded-xl p-5 bg-green-900/20 space-y-4">
                    <h3 class="text-lg font-bold gaming-title text-neon-green mb-3">üìÖ Daily Check-in Quest</h3>
                    
                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">STREAK BONUS</label>
                        <select id="dailyStreakBonus" class="w-full bg-black/50 border-2 border-neon-green/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                            <option value="none">No Streak Bonus</option>
                            <option value="multiply">Multiply by Streak (Day 7 = 7x points)</option>
                            <option value="milestone">Milestone Bonuses (Day 7, 30, 100)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">RESET TIME (UTC)</label>
                        <input id="dailyResetTime" type="time" value="00:00" class="w-full bg-black/50 border-2 border-neon-green/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                        <p class="text-xs text-gray-400 mt-1">When the daily quest resets</p>
                    </div>

                    <div>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input id="dailyStreakRequired" type="checkbox" class="w-5 h-5 rounded border-2 border-neon-green/50 bg-black/50">
                            <span class="text-sm gaming-body">Require consecutive days (break streak if missed)</span>
                        </label>
                    </div>

                    <div class="p-3 bg-neon-green/10 border border-neon-green/30 rounded-lg">
                        <p class="text-sm text-gray-300">
                            ‚ö° <strong>Auto-Completion:</strong> Simple button click. Users can complete once per day.
                        </p>
                    </div>
                </div>

                <!-- Manual Quest Fields -->
                <div id="manualFields" class="hidden border-2 border-neon-purple/30 rounded-xl p-5 bg-purple-900/20 space-y-4">
                    <h3 class="text-lg font-bold gaming-title text-neon-purple mb-3">‚úçÔ∏è Manual Verification Quest</h3>
                    
                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">QUEST URL (Optional)</label>
                        <input id="manualUrl" type="url" placeholder="https://..." class="w-full bg-black/50 border-2 border-neon-purple/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                        <p class="text-xs text-gray-400 mt-1">Link to instructions or external platform</p>
                    </div>

                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">SUBMISSION TYPE</label>
                        <select id="manualSubmissionType" class="w-full bg-black/50 border-2 border-neon-purple/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                            <option value="none">No Submission Needed</option>
                            <option value="text">Text/Link Submission</option>
                            <option value="screenshot">Screenshot Upload</option>
                            <option value="code">Enter Code</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-neon-blue gaming-title text-sm mb-2">INSTRUCTIONS FOR USERS</label>
                        <textarea id="manualInstructions" rows="3" placeholder="Tell users exactly what they need to do..." class="w-full bg-black/50 border-2 border-neon-purple/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple"></textarea>
                    </div>

                    <div class="p-3 bg-neon-purple/10 border border-neon-purple/30 rounded-lg">
                        <p class="text-sm text-gray-300">
                            ‚ö° <strong>Admin Review:</strong> Users submit quest completion. Admin manually approves/rejects.
                        </p>
                    </div>
                </div>

                <!-- Hidden Fields -->
                <input type="hidden" id="taskType" value="social">
                <input type="hidden" id="taskPlatform" value="">
                
                <button type="submit" id="submitQuestBtn" class="hidden w-full py-4 bg-gradient-to-r from-neon-purple to-neon-pink hover:from-neon-pink hover:to-neon-yellow rounded-xl gaming-title font-bold text-lg transition-all hover:scale-105">
                    üöÄ CREATE QUEST
                </button>
            </form>
        </div>
    </div>

    <!-- Reward Modal -->
    <div id="rewardModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-gradient-to-br from-gaming-dark to-purple-900/40 border-2 border-neon-pink/50 rounded-2xl p-8 w-full max-w-2xl card-glow">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-black gaming-title gradient-text">üíé ADD NEW LOOT</h2>
                <button onclick="closeModal('rewardModal')" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            
            <form id="rewardForm" onsubmit="submitReward(event)" class="space-y-4">
                <div>
                    <label class="block text-neon-pink gaming-title text-sm mb-2">LOOT TITLE</label>
                    <input id="rewardTitle" type="text" required class="w-full bg-black/50 border-2 border-neon-pink/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                </div>
                
                <div>
                    <label class="block text-neon-pink gaming-title text-sm mb-2">DESCRIPTION</label>
                    <textarea id="rewardDescription" rows="3" required class="w-full bg-black/50 border-2 border-neon-pink/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-neon-pink gaming-title text-sm mb-2">TYPE</label>
                        <select id="rewardType" required class="w-full bg-black/50 border-2 border-neon-pink/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                            <option value="digital">Digital</option>
                            <option value="physical">Physical</option>
                            <option value="voucher">Voucher</option>
                            <option value="special">Special</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-neon-pink gaming-title text-sm mb-2">XP COST</label>
                        <input id="rewardCost" type="number" required min="1" class="w-full bg-black/50 border-2 border-neon-pink/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                    </div>
                </div>
                
                <div>
                    <label class="block text-neon-pink gaming-title text-sm mb-2">STOCK (leave empty for unlimited)</label>
                    <input id="rewardQuantity" type="number" min="1" class="w-full bg-black/50 border-2 border-neon-pink/30 rounded-xl px-4 py-3 text-white gaming-body focus:outline-none focus:border-neon-purple">
                </div>
                
                <button type="submit" class="w-full py-4 bg-gradient-to-r from-neon-purple to-neon-pink hover:from-neon-pink hover:to-neon-yellow rounded-xl gaming-title font-bold text-lg transition-all hover:scale-105">
                    üíé ADD LOOT
                </button>
            </form>
        </div>
    </div>

    <script>
        // Configuration - API URL
        // Handle both localhost and GitHub Codespaces URLs
        let API_BASE;
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            // Local development
            API_BASE = window.location.origin.replace(':8080', ':8000');
        } else {
            // GitHub Codespaces - replace 8080 port in URL
            API_BASE = window.location.origin.replace('-8080.', '-8000.');
        }
        const API_URL = `${API_BASE}/api`;
        let authToken = null;
        
        console.log('Admin API_URL configured:', API_URL);

        // Check Server Status
        async function checkServerStatus() {
            // Helper function to update both login and dashboard status
            const updateStatus = (elementId, status, text, port = '') => {
                const loginElement = document.getElementById(elementId);
                const dashboardElement = document.getElementById('dashboard' + elementId.charAt(0).toUpperCase() + elementId.slice(1));
                
                if (loginElement) {
                    loginElement.innerHTML = `
                        <span class="text-${status === 'ok' ? 'green' : status === 'error' ? 'red' : 'gray'}-400">${status === 'ok' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚ö†Ô∏è'}</span> 
                        <span class="text-${status === 'ok' ? 'green' : status === 'error' ? 'red' : 'gray'}-400 font-bold">${text}</span>
                    `;
                }
                
                if (dashboardElement) {
                    dashboardElement.innerHTML = `
                        <span class="text-${status === 'ok' ? 'green' : status === 'error' ? 'red' : 'gray'}-400">${status === 'ok' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚ö†Ô∏è'}</span>
                        <div>
                            <div class="text-sm font-bold gaming-title text-${status === 'ok' ? 'green' : status === 'error' ? 'red' : 'gray'}-400">${text}</div>
                            ${port ? `<div class="text-xs text-gray-600">${port}</div>` : ''}
                        </div>
                    `;
                }
            };
            
            // Check Frontend Server (always running if this page loads)
            updateStatus('frontendStatus', 'ok', 'RUNNING', 'Port 8080');

            // Check API Server
            try {
                const apiResponse = await fetch(`${API_URL.replace('/api', '')}/`, { 
                    method: 'GET',
                    signal: AbortSignal.timeout(3000) // 3 second timeout
                });
                
                if (apiResponse.ok) {
                    updateStatus('apiStatus', 'ok', 'RUNNING', 'Port 8000');
                    
                    // Check Database (via users endpoint)
                    try {
                        const dbResponse = await fetch(`${API_URL}/users?limit=1`, {
                            signal: AbortSignal.timeout(3000)
                        });
                        
                        if (dbResponse.ok) {
                            updateStatus('databaseStatus', 'ok', 'CONNECTED', 'PostgreSQL');
                        } else {
                            throw new Error('Database check failed');
                        }
                    } catch (dbError) {
                        updateStatus('databaseStatus', 'error', 'OFFLINE', 'PostgreSQL');
                    }
                } else {
                    throw new Error('API not responding');
                }
            } catch (apiError) {
                updateStatus('apiStatus', 'error', 'OFFLINE', 'Port 8000');
                updateStatus('databaseStatus', 'warning', 'N/A', 'PostgreSQL');
            }
        }

        // Run status check on page load
        checkServerStatus();
        // Recheck every 30 seconds
        setInterval(checkServerStatus, 30000);

        // Handle authentication errors
        function handleAuthError() {
            console.error('Authentication failed - token expired or invalid');
            authToken = null;
            localStorage.removeItem('authToken');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            alert('üîí Session expired! Please login again.');
        }

        // Login
        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (!response.ok) throw new Error('Login failed');

                const data = await response.json();
                authToken = data.access_token;
                localStorage.setItem('authToken', authToken);

                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                loadDashboard();
            } catch (error) {
                alert('‚ùå Login failed! Check credentials.');
                console.error(error);
            }
        }

        // Logout
        function logout() {
            authToken = null;
            localStorage.removeItem('authToken');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        // Show section
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.dataset.section === sectionId) {
                    btn.className = 'tab-btn px-6 py-3 bg-gradient-to-r from-neon-blue/20 to-neon-purple/20 border-2 border-neon-blue/50 rounded-xl gaming-title font-bold transition-all';
                } else {
                    btn.className = 'tab-btn px-6 py-3 bg-gaming-dark/50 border-2 border-gray-700 rounded-xl gaming-title font-bold hover:border-neon-purple/50 hover:scale-105 transition-all';
                }
            });

            // Load data for section
            if (sectionId === 'dashboard') loadDashboard();
            else if (sectionId === 'users') loadUsers();
            else if (sectionId === 'tasks') loadTasks();
            else if (sectionId === 'rewards') loadRewards();
            else if (sectionId === 'verification') loadVerification();
        }

        // Load dashboard
        async function loadDashboard() {
            // Dashboard is now just a welcome screen
            // No stats to load
        }

        // Load users
        async function loadUsers() {
            try {
                const response = await fetch(`${API_URL}/users`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const users = await response.json();
                
                document.getElementById('userCount').textContent = users.length;
                
                // Desktop table
                const tbody = document.getElementById('usersTable');
                tbody.innerHTML = users.map(user => `
                    <tr class="table-row">
                        <td class="px-4 py-4">
                            <div class="font-bold text-white gaming-body">${user.first_name || 'Unknown'} ${user.last_name || ''}</div>
                        </td>
                        <td class="px-4 py-4 text-gray-300 gaming-body">@${user.username || 'N/A'}</td>
                        <td class="px-4 py-4">
                            <span class="px-3 py-1 bg-neon-purple/20 border border-neon-purple/50 rounded-lg text-neon-purple gaming-title text-sm">
                                LVL ${Math.floor((user.total_points_earned || 0) / 100) + 1}
                            </span>
                        </td>
                        <td class="px-4 py-4 text-neon-green font-bold gaming-body">${user.points || 0}</td>
                        <td class="px-4 py-4 text-neon-blue font-bold gaming-body">${user.total_points_earned || 0}</td>
                        <td class="px-4 py-4">
                            <span class="px-3 py-1 ${user.is_banned ? 'bg-red-900/30 border-red-500/50 text-red-400' : 'bg-neon-green/20 border-neon-green/50 text-neon-green'} border rounded-lg gaming-title text-sm">
                                ${user.is_banned ? 'üö´ BANNED' : '‚úì ACTIVE'}
                            </span>
                        </td>
                        <td class="px-4 py-4">
                            <button onclick="toggleUserBan('${user.telegram_id}')" class="px-4 py-2 ${user.is_banned ? 'bg-neon-green/20 hover:bg-neon-green/30 border-neon-green/50' : 'bg-red-900/30 hover:bg-red-900/50 border-red-500/50'} border rounded-lg gaming-title text-sm transition-all hover:scale-105">
                                ${user.is_banned ? 'UNBAN' : 'BAN'}
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                // Mobile cards
                const cardsContainer = document.getElementById('usersCards');
                cardsContainer.innerHTML = users.map(user => `
                    <div class="bg-gradient-to-br from-black/60 to-gray-900/40 border-2 ${user.is_banned ? 'border-red-500/30' : 'border-neon-blue/30'} rounded-xl p-4">
                        <!-- Header -->
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <h3 class="text-white font-bold gaming-body text-lg">${user.first_name || 'Unknown'} ${user.last_name || ''}</h3>
                                <p class="text-gray-400 text-sm gaming-body">@${user.username || 'N/A'}</p>
                            </div>
                            <span class="px-2 py-1 ${user.is_banned ? 'bg-red-900/30 border-red-500/50 text-red-400' : 'bg-neon-green/20 border-neon-green/50 text-neon-green'} border rounded-lg gaming-title text-xs whitespace-nowrap ml-2">
                                ${user.is_banned ? 'üö´ BANNED' : '‚úì ACTIVE'}
                            </span>
                        </div>
                        
                        <!-- Stats Grid -->
                        <div class="grid grid-cols-3 gap-3 mb-3">
                            <div class="bg-neon-purple/10 border border-neon-purple/30 rounded-lg p-2 text-center">
                                <div class="text-gray-400 text-xs gaming-title mb-1">LEVEL</div>
                                <div class="text-neon-purple font-bold gaming-body">${Math.floor((user.total_points_earned || 0) / 100) + 1}</div>
                            </div>
                            <div class="bg-neon-green/10 border border-neon-green/30 rounded-lg p-2 text-center">
                                <div class="text-gray-400 text-xs gaming-title mb-1">XP</div>
                                <div class="text-neon-green font-bold gaming-body">${user.points || 0}</div>
                            </div>
                            <div class="bg-neon-blue/10 border border-neon-blue/30 rounded-lg p-2 text-center">
                                <div class="text-gray-400 text-xs gaming-title mb-1">EARNED</div>
                                <div class="text-neon-blue font-bold gaming-body">${user.total_points_earned || 0}</div>
                            </div>
                        </div>
                        
                        <!-- Action -->
                        <button onclick="toggleUserBan('${user.telegram_id}')" class="w-full px-4 py-2 ${user.is_banned ? 'bg-neon-green/20 hover:bg-neon-green/30 border-neon-green/50' : 'bg-red-900/30 hover:bg-red-900/50 border-red-500/50'} border rounded-lg gaming-title text-sm transition-all">
                            ${user.is_banned ? '‚úÖ UNBAN PLAYER' : 'üö´ BAN PLAYER'}
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // Load tasks
        async function loadTasks() {
            try {
                const response = await fetch(`${API_URL}/tasks`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const tasks = await response.json();
                
                // Desktop table view
                const tbody = document.getElementById('tasksTable');
                tbody.innerHTML = tasks.map(task => {
                    const rarityColors = {
                        'common': 'text-gray-400 border-gray-500/50',
                        'rare': 'text-neon-blue border-neon-blue/50',
                        'epic': 'text-neon-purple border-neon-purple/50',
                        'legendary': 'text-neon-yellow border-neon-yellow/50'
                    };
                    const rarity = task.points_reward < 50 ? 'common' : task.points_reward < 100 ? 'rare' : task.points_reward < 200 ? 'epic' : 'legendary';
                    
                    return `
                    <tr class="table-row">
                        <td class="px-4 py-4">
                            <div class="font-bold text-white gaming-body">${task.title}</div>
                            ${task.is_bonus ? '<span class="text-neon-yellow text-xs">‚≠ê BONUS</span>' : ''}
                        </td>
                        <td class="px-4 py-4 text-gray-300 gaming-body capitalize">${task.task_type || 'N/A'}</td>
                        <td class="px-4 py-4 text-gray-300 gaming-body capitalize">${task.platform || '‚Äî'}</td>
                        <td class="px-4 py-4 text-neon-green font-bold gaming-body">+${task.points_reward} XP</td>
                        <td class="px-4 py-4">
                            <span class="px-3 py-1 bg-black/30 border ${rarityColors[rarity]} rounded-lg gaming-title text-xs uppercase">
                                ${rarity}
                            </span>
                        </td>
                        <td class="px-4 py-4">
                            <span class="px-3 py-1 ${task.is_active ? 'bg-neon-green/20 border-neon-green/50 text-neon-green' : 'bg-gray-700/30 border-gray-600/50 text-gray-400'} border rounded-lg gaming-title text-sm">
                                ${task.is_active ? '‚úì ACTIVE' : '‚è∏ INACTIVE'}
                            </span>
                        </td>
                        <td class="px-4 py-4">
                            <div class="flex gap-2">
                                <button onclick="editTask('${task.id}')" class="px-3 py-2 bg-blue-900/30 hover:bg-blue-900/50 border border-blue-500/50 rounded-lg gaming-title text-xs transition-all hover:scale-105" title="Edit Quest">
                                    ‚úèÔ∏è EDIT
                                </button>
                                <button onclick="toggleTaskStatus('${task.id}', ${task.is_active})" class="px-3 py-2 ${task.is_active ? 'bg-yellow-900/30 hover:bg-yellow-900/50 border-yellow-500/50' : 'bg-green-900/30 hover:bg-green-900/50 border-green-500/50'} border rounded-lg gaming-title text-xs transition-all hover:scale-105" title="${task.is_active ? 'Deactivate' : 'Activate'} Quest">
                                    ${task.is_active ? '‚è∏' : '‚ñ∂Ô∏è'}
                                </button>
                                <button onclick="deleteTask('${task.id}')" class="px-3 py-2 bg-red-900/30 hover:bg-red-900/50 border border-red-500/50 rounded-lg gaming-title text-xs transition-all hover:scale-105" title="Delete Quest">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                }).join('');
                
                // Mobile card view
                const cardsContainer = document.getElementById('tasksCards');
                cardsContainer.innerHTML = tasks.map(task => {
                    const rarityColors = {
                        'common': 'text-gray-400 border-gray-500/50 bg-gray-900/30',
                        'rare': 'text-neon-blue border-neon-blue/50 bg-blue-900/20',
                        'epic': 'text-neon-purple border-neon-purple/50 bg-purple-900/20',
                        'legendary': 'text-neon-yellow border-neon-yellow/50 bg-yellow-900/20'
                    };
                    const rarity = task.points_reward < 50 ? 'common' : task.points_reward < 100 ? 'rare' : task.points_reward < 200 ? 'epic' : 'legendary';
                    
                    return `
                    <div class="bg-gradient-to-br from-black/60 to-gray-900/40 border-2 ${task.is_active ? 'border-neon-purple/30' : 'border-gray-700/50'} rounded-xl p-4">
                        <!-- Header -->
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <h3 class="text-white font-bold gaming-body text-lg mb-1">${task.title}</h3>
                                ${task.is_bonus ? '<span class="text-neon-yellow text-xs">‚≠ê BONUS</span>' : ''}
                            </div>
                            <span class="px-2 py-1 ${task.is_active ? 'bg-neon-green/20 border-neon-green/50 text-neon-green' : 'bg-gray-700/30 border-gray-600/50 text-gray-400'} border rounded-lg gaming-title text-xs whitespace-nowrap ml-2">
                                ${task.is_active ? '‚úì ACTIVE' : '‚è∏ INACTIVE'}
                            </span>
                        </div>
                        
                        <!-- Details Grid -->
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div>
                                <div class="text-gray-400 text-xs gaming-title mb-1">TYPE</div>
                                <div class="text-white gaming-body capitalize text-sm">${task.task_type || 'N/A'}</div>
                            </div>
                            <div>
                                <div class="text-gray-400 text-xs gaming-title mb-1">PLATFORM</div>
                                <div class="text-white gaming-body capitalize text-sm">${task.platform || '‚Äî'}</div>
                            </div>
                            <div>
                                <div class="text-gray-400 text-xs gaming-title mb-1">XP REWARD</div>
                                <div class="text-neon-green font-bold gaming-body text-sm">+${task.points_reward} XP</div>
                            </div>
                            <div>
                                <div class="text-gray-400 text-xs gaming-title mb-1">RARITY</div>
                                <span class="inline-block px-2 py-1 border ${rarityColors[rarity]} rounded-lg gaming-title text-xs uppercase">
                                    ${rarity}
                                </span>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex gap-2">
                            <button onclick="editTask('${task.id}')" class="flex-1 px-3 py-2 bg-blue-900/30 hover:bg-blue-900/50 border border-blue-500/50 rounded-lg gaming-title text-xs transition-all">
                                ‚úèÔ∏è EDIT
                            </button>
                            <button onclick="toggleTaskStatus('${task.id}', ${task.is_active})" class="flex-1 px-3 py-2 ${task.is_active ? 'bg-yellow-900/30 hover:bg-yellow-900/50 border-yellow-500/50' : 'bg-green-900/30 hover:bg-green-900/50 border-green-500/50'} border rounded-lg gaming-title text-xs transition-all">
                                ${task.is_active ? '‚è∏ PAUSE' : '‚ñ∂Ô∏è ACTIVATE'}
                            </button>
                            <button onclick="deleteTask('${task.id}')" class="px-3 py-2 bg-red-900/30 hover:bg-red-900/50 border border-red-500/50 rounded-lg gaming-title text-xs transition-all">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
                }).join('');
            } catch (error) {
                console.error('Error loading tasks:', error);
            }
        }

        // Load rewards
        async function loadRewards() {
            try {
                const response = await fetch(`${API_URL}/rewards`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const rewards = await response.json();
                
                const tbody = document.getElementById('rewardsTable');
                tbody.innerHTML = rewards.map(reward => `
                    <tr class="table-row">
                        <td class="px-4 py-4">
                            <div class="font-bold text-white gaming-body">${reward.title}</div>
                        </td>
                        <td class="px-4 py-4 text-gray-300 gaming-body capitalize">${reward.reward_type || 'N/A'}</td>
                        <td class="px-4 py-4 text-neon-purple font-bold gaming-body">${reward.points_cost} XP</td>
                        <td class="px-4 py-4 text-neon-blue font-bold gaming-body">${reward.quantity_available || '‚àû'}</td>
                        <td class="px-4 py-4 text-neon-pink font-bold gaming-body">${reward.quantity_claimed || 0}</td>
                        <td class="px-4 py-4">
                            <span class="px-3 py-1 ${reward.is_active ? 'bg-neon-green/20 border-neon-green/50 text-neon-green' : 'bg-gray-700/30 border-gray-600/50 text-gray-400'} border rounded-lg gaming-title text-sm">
                                ${reward.is_active ? '‚úì ACTIVE' : '‚è∏ INACTIVE'}
                            </span>
                        </td>
                        <td class="px-4 py-4">
                            <button class="px-4 py-2 bg-neon-purple/20 hover:bg-neon-purple/30 border border-neon-purple/50 rounded-lg gaming-title text-sm transition-all hover:scale-105">
                                ‚úè EDIT
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading rewards:', error);
            }
        }

        // Load verification
        async function loadVerification() {
            try {
                const response = await fetch(`${API_URL}/admin/user-tasks?status=submitted`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const userTasks = await response.json();
                
                document.getElementById('verificationCount').textContent = userTasks.length;
                
                const tbody = document.getElementById('verificationTable');
                if (userTasks.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center py-12 text-gray-500">No pending verifications</td></tr>';
                    return;
                }
                
                tbody.innerHTML = userTasks.map(ut => `
                    <tr class="table-row">
                        <td class="px-4 py-4 text-white font-bold gaming-body">${ut.users?.first_name || 'Unknown'}</td>
                        <td class="px-4 py-4 text-gray-300 gaming-body">${ut.tasks?.title || 'Unknown'}</td>
                        <td class="px-4 py-4 text-neon-green font-bold gaming-body">+${ut.tasks?.points_reward || 0} XP</td>
                        <td class="px-4 py-4">
                            ${ut.proof_url ? `<a href="${ut.proof_url}" target="_blank" class="text-neon-blue hover:text-neon-purple transition-colors">üîó View Proof</a>` : '<span class="text-gray-500">No proof</span>'}
                        </td>
                        <td class="px-4 py-4 text-gray-400 text-sm gaming-body">${new Date(ut.created_at).toLocaleDateString()}</td>
                        <td class="px-4 py-4">
                            <div class="flex gap-2">
                                <button onclick="verifyTask('${ut.id}', true)" class="px-4 py-2 bg-neon-green/20 hover:bg-neon-green/30 border border-neon-green/50 rounded-lg gaming-title text-sm text-neon-green transition-all hover:scale-105">
                                    ‚úì APPROVE
                                </button>
                                <button onclick="verifyTask('${ut.id}', false)" class="px-4 py-2 bg-red-900/30 hover:bg-red-900/50 border border-red-500/50 rounded-lg gaming-title text-sm transition-all hover:scale-105">
                                    ‚úó REJECT
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading verification:', error);
            }
        }

        // Submit task
        async function submitTask(event) {
            event.preventDefault();

            if (!selectedQuestType) {
                alert('‚ö†Ô∏è Please select a quest type first!');
                return;
            }

            // Base task payload
            const base = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                platform: document.getElementById('taskPlatform').value || null,
                points_reward: parseInt(document.getElementById('taskPoints').value) || 0,
                is_bonus: false,
                is_active: true, // New quests are active by default
                url: null,
                verification_data: {}
            };

            // Determine task_type, verification_required and build verification_data
            let task_type = 'custom';
            let verification_required = true;

            if (selectedQuestType === 'twitter') {
                const actionType = document.getElementById('twitterActionType').value;
                const username = document.getElementById('twitterUsername').value.trim();

                if (!username) {
                    alert('‚ö†Ô∏è Please enter the target Twitter username!');
                    return;
                }

                const twitterTypeMap = {
                    'follow': 'twitter_follow',
                    'like': 'twitter_like',
                    'retweet': 'twitter_retweet',
                    'reply': 'twitter_reply'
                };

                task_type = twitterTypeMap[actionType] || 'twitter_action';
                base.verification_data = { method: 'twitter_api', type: actionType, username };
                base.url = `https://twitter.com/${username}`;

                if (actionType !== 'follow') {
                    const tweetUrl = document.getElementById('twitterTweetUrl').value.trim();
                    if (!tweetUrl) {
                        alert('‚ö†Ô∏è Please enter the tweet URL!');
                        return;
                    }
                    base.url = tweetUrl;
                    const tweetIdMatch = tweetUrl.match(/status\/(\d+)/);
                    if (tweetIdMatch) base.verification_data.tweet_id = tweetIdMatch[1];
                }

            } else if (selectedQuestType === 'telegram') {
                const actionType = document.getElementById('telegramActionType').value;
                const telegramLink = document.getElementById('telegramLink').value.trim();
                const chatId = document.getElementById('telegramChatId').value.trim();
                const chatName = document.getElementById('telegramChatName').value.trim();

                if (!telegramLink) {
                    alert('‚ö†Ô∏è Please enter the Telegram link!');
                    return;
                }
                if (!chatId) {
                    alert('‚ö†Ô∏è Please enter the Group/Channel ID!');
                    return;
                }
                if (!chatName) {
                    alert('‚ö†Ô∏è Please enter the Group/Channel name!');
                    return;
                }

                const telegramTypeMap = {
                    'join_group': 'telegram_join_group',
                    'join_channel': 'telegram_join_channel'
                };

                task_type = telegramTypeMap[actionType] || 'telegram_action';
                base.url = telegramLink;
                base.verification_data = {
                    method: 'telegram_membership',
                    type: actionType,
                    chat_id: chatId,
                    chat_name: chatName,
                    invite_link: telegramLink
                };

            } else if (selectedQuestType === 'youtube') {
                const youtubeUrl = document.getElementById('youtubeUrl').value.trim();
                const secretCode = document.getElementById('youtubeSecretCode').value.trim();

                if (!youtubeUrl) { alert('‚ö†Ô∏è Please enter the YouTube video URL!'); return; }
                if (!secretCode) { alert('‚ö†Ô∏è Please enter a secret code for the video!'); return; }

                task_type = 'youtube_watch';
                base.url = youtubeUrl;
                base.verification_data = {
                    method: 'time_delay_code',
                    code: secretCode,
                    min_watch_time_seconds: parseInt(document.getElementById('youtubeMinWatchTime').value) || 120,
                    code_timestamp: document.getElementById('youtubeCodeHint').value || 'during the video',
                    max_attempts: parseInt(document.getElementById('youtubeMaxAttempts').value) || 3
                };

            } else if (selectedQuestType === 'daily') {
                const streakBonus = document.getElementById('dailyStreakBonus').value;
                const resetTime = document.getElementById('dailyResetTime').value;
                const streakRequired = document.getElementById('dailyStreakRequired').checked;

                task_type = 'daily_checkin';
                verification_required = false; // daily check-in is normally auto-complete
                base.verification_data = {
                    method: 'daily_checkin',
                    streak_bonus: streakBonus,
                    reset_time_utc: resetTime,
                    consecutive_required: streakRequired,
                    frequency: 'daily'
                };

            } else if (selectedQuestType === 'manual') {
                const submissionType = document.getElementById('manualSubmissionType').value;
                const instructions = document.getElementById('manualInstructions').value.trim();
                const manualUrl = document.getElementById('manualUrl').value.trim();

                task_type = 'manual_review';
                base.url = manualUrl || null;
                base.verification_data = {
                    method: 'manual_review',
                    submission_type: submissionType,
                    instructions: instructions,
                    requires_approval: true
                };
            }

            // Compose final payload
            const taskData = Object.assign({}, base, {
                task_type,
                verification_required
            });

            // Remove verification_data if empty
            if (!taskData.verification_data || Object.keys(taskData.verification_data).length === 0) {
                delete taskData.verification_data;
            }

            try {
                // Determine if we're creating or updating
                const isEditing = editingTaskId !== null;
                const url = isEditing ? `${API_URL}/tasks/${editingTaskId}` : `${API_URL}/tasks`;
                const method = isEditing ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(taskData)
                });

                if (response.ok) {
                    const emoji = {
                        'twitter': 'üê¶',
                        'telegram': '‚úàÔ∏è',
                        'youtube': 'üì∫',
                        'daily': 'üìÖ',
                        'manual': '‚úçÔ∏è'
                    }[selectedQuestType] || '‚öîÔ∏è';

                    const action = isEditing ? 'updated' : 'created';
                    alert(`${emoji} ${selectedQuestType.toUpperCase()} quest ${action} successfully!`);
                    closeModal('taskModal');
                    loadTasks();
                    document.getElementById('taskForm').reset();
                    editingTaskId = null; // Reset edit mode
                } else {
                    if (response.status === 401) { handleAuthError(); return; }
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = errorData.detail || errorData.message || `HTTP ${response.status}: ${response.statusText}`;
                    const action = isEditing ? 'update' : 'create';
                    console.error(`Failed to ${action} quest:`, errorMessage, errorData);
                    alert(`‚ùå Failed to ${action} quest!\n\nError: ${errorMessage}`);
                }
            } catch (error) {
                const action = editingTaskId ? 'updating' : 'creating';
                console.error(`Error ${action} task:`, error);
                alert(`‚ùå Network error: ${error.message}\n\nPlease check your connection and try again.`);
            }
        }

        // Submit reward
        async function submitReward(event) {
            event.preventDefault();

            const rewardData = {
                title: document.getElementById('rewardTitle').value,
                description: document.getElementById('rewardDescription').value,
                reward_type: document.getElementById('rewardType').value,
                points_cost: parseInt(document.getElementById('rewardCost').value),
                quantity_available: document.getElementById('rewardQuantity').value ? 
                                   parseInt(document.getElementById('rewardQuantity').value) : null
            };

            try {
                const response = await fetch(`${API_URL}/rewards`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(rewardData)
                });

                if (response.ok) {
                    alert('üíé Loot added successfully!');
                    closeModal('rewardModal');
                    loadRewards();
                    document.getElementById('rewardForm').reset();
                } else {
                    // Handle error response
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = errorData.detail || errorData.message || `HTTP ${response.status}: ${response.statusText}`;
                    console.error('Failed to create reward:', errorMessage, errorData);
                    alert(`‚ùå Failed to add loot!\n\nError: ${errorMessage}`);
                }
            } catch (error) {
                console.error('Error creating reward:', error);
                alert(`‚ùå Network error: ${error.message}\n\nPlease check your connection and try again.`);
            }
        }

        // Verify task
        async function verifyTask(userTaskId, approved) {
            try {
                const response = await fetch(`${API_URL}/admin/user-tasks/${userTaskId}/verify?approved=${approved}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    alert(`${approved ? '‚úÖ Quest approved!' : '‚ùå Quest rejected!'}`);
                    loadVerification();
                }
            } catch (error) {
                console.error('Error verifying task:', error);
            }
        }

        // Toggle user ban
        async function toggleUserBan(userId) {
            try {
                const response = await fetch(`${API_URL}/admin/users/${userId}/ban`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    alert('‚úì Player status updated!');
                    loadUsers();
                }
            } catch (error) {
                console.error('Error toggling user ban:', error);
            }
        }

        // Delete task
        async function deleteTask(taskId) {
            if (!confirm('‚ö†Ô∏è Delete this quest permanently?')) return;

            // Check if user is authenticated
            if (!authToken) {
                alert('‚ö†Ô∏è You are not logged in! Please refresh the page and log in again.');
                handleAuthError();
                return;
            }

            try {
                const response = await fetch(`${API_URL}/tasks/${taskId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    alert('üóë Quest deleted!');
                    loadTasks();
                } else if (response.status === 401) {
                    alert('üîí Session expired! Please log in again.');
                    handleAuthError();
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = errorData.detail || errorData.message || `HTTP ${response.status}`;
                    alert(`‚ùå Failed to delete quest!\n\nError: ${errorMessage}`);
                }
            } catch (error) {
                console.error('Error deleting task:', error);
                alert(`‚ùå Network error: ${error.message}`);
            }
        }

        // Edit task
        let editingTaskId = null;
        
        async function editTask(taskId) {
            // Redirect to dedicated edit page
            window.location.href = `/edit-quest.html?id=${taskId}`;
        }
        
        // Legacy edit function (kept for reference, not used)
        async function editTaskModal(taskId) {
            try {
                // Fetch task details
                const response = await fetch(`${API_URL}/tasks/${taskId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (!response.ok) throw new Error('Failed to fetch task');
                
                const task = await response.json();
                editingTaskId = taskId;
                
                // Show modal
                document.getElementById('taskModal').classList.remove('hidden');
                
                // Change modal title
                document.querySelector('#taskModal h2').textContent = '‚úèÔ∏è EDIT QUEST';
                document.getElementById('submitQuestBtn').textContent = 'üíæ UPDATE QUEST';
                
                // Pre-fill common fields
                document.getElementById('taskTitle').value = task.title || '';
                document.getElementById('taskDescription').value = task.description || '';
                document.getElementById('taskPoints').value = task.points_reward || 0;
                
                // Determine quest type and select it
                let questType = 'manual'; // default
                if (task.task_type) {
                    if (task.task_type.startsWith('twitter_')) {
                        questType = 'twitter';
                    } else if (task.task_type.startsWith('telegram_')) {
                        questType = 'telegram';
                    } else if (task.task_type === 'youtube_watch') {
                        questType = 'youtube';
                    } else if (task.task_type === 'daily_checkin') {
                        questType = 'daily';
                    } else if (task.task_type === 'manual_review') {
                        questType = 'manual';
                    }
                }
                
                // Select quest type
                selectQuestType(questType);
                
                // Pre-fill type-specific fields
                if (questType === 'twitter' && task.verification_data) {
                    const actionType = task.task_type.replace('twitter_', '');
                    document.getElementById('twitterActionType').value = actionType;
                    document.getElementById('twitterUsername').value = task.verification_data.username || '';
                    if (task.url) {
                        document.getElementById('twitterTweetUrl').value = task.url;
                    }
                    updateTwitterFields();
                } else if (questType === 'telegram' && task.verification_data) {
                    const actionType = task.task_type.replace('telegram_', '');
                    document.getElementById('telegramActionType').value = actionType;
                    document.getElementById('telegramLink').value = task.url || task.verification_data.invite_link || '';
                    document.getElementById('telegramChatId').value = task.verification_data.chat_id || '';
                    document.getElementById('telegramChatName').value = task.verification_data.chat_name || '';
                } else if (questType === 'youtube' && task.verification_data) {
                    document.getElementById('youtubeUrl').value = task.url || '';
                    document.getElementById('youtubeSecretCode').value = task.verification_data.code || '';
                    document.getElementById('youtubeMinWatchTime').value = task.verification_data.min_watch_seconds || 120;
                    document.getElementById('youtubeMaxAttempts').value = task.verification_data.max_attempts || 3;
                    document.getElementById('youtubeCodeHint').value = task.verification_data.code_hint || 'during the video';
                } else if (questType === 'daily' && task.verification_data) {
                    document.getElementById('dailyStreakBonus').value = task.verification_data.streak_bonus || 'none';
                    document.getElementById('dailyResetTime').value = task.verification_data.reset_time || '00:00';
                    document.getElementById('dailyStreakRequired').checked = task.verification_data.consecutive_required || false;
                } else if (questType === 'manual') {
                    document.getElementById('manualUrl').value = task.url || '';
                    if (task.verification_data) {
                        document.getElementById('manualSubmissionType').value = task.verification_data.submission_type || 'none';
                        document.getElementById('manualInstructions').value = task.verification_data.instructions || '';
                    }
                }
                
            } catch (error) {
                console.error('Error loading task for edit:', error);
                alert('‚ùå Failed to load quest details');
            }
        }

        // Toggle task active/inactive status
        async function toggleTaskStatus(taskId, currentStatus) {
            const newStatus = !currentStatus;
            
            if (!confirm(`${newStatus ? '‚ñ∂Ô∏è Activate' : '‚è∏ Deactivate'} this quest?`)) return;

            // Check if user is authenticated
            if (!authToken) {
                alert('‚ö†Ô∏è You are not logged in! Please refresh the page and log in again.');
                handleAuthError();
                return;
            }

            try {
                const response = await fetch(`${API_URL}/tasks/${taskId}/toggle`, {
                    method: 'PATCH',
                    headers: { 
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    alert(`${result.is_active ? '‚úÖ Quest activated!' : '‚è∏ Quest deactivated!'}`);
                    loadTasks();
                } else if (response.status === 401) {
                    alert('üîí Session expired! Please log in again.');
                    handleAuthError();
                } else {
                    const error = await response.json().catch(() => ({}));
                    throw new Error(error.detail || 'Failed to update status');
                }
            } catch (error) {
                console.error('Error toggling task status:', error);
                alert(`‚ùå Failed to toggle quest status: ${error.message}`);
            }
        }

        // Modal functions
        let selectedQuestType = null;

        function showAddTaskModal() {
            document.getElementById('taskModal').classList.remove('hidden');
            
            // Reset edit mode
            editingTaskId = null;
            document.querySelector('#taskModal h2').textContent = '‚öîÔ∏è CREATE NEW QUEST';
            document.getElementById('submitQuestBtn').textContent = 'üöÄ CREATE QUEST';
            
            // Reset form
            document.getElementById('taskForm').reset();
            selectedQuestType = null;
            document.querySelectorAll('.quest-type-btn').forEach(btn => {
                btn.classList.remove('border-neon-purple', 'bg-neon-purple/20');
                btn.classList.add('border-neon-blue/30');
            });
            document.querySelectorAll('.common-fields, #twitterFields, #telegramFields, #youtubeFields, #dailyFields, #manualFields').forEach(el => el.style.display = 'none');
            document.getElementById('submitQuestBtn').classList.add('hidden');
        }

        function selectQuestType(type) {
            selectedQuestType = type;
            
            // Update button styles
            document.querySelectorAll('.quest-type-btn').forEach(btn => {
                if (btn.dataset.type === type) {
                    btn.classList.remove('border-neon-blue/30');
                    btn.classList.add('border-neon-purple', 'bg-neon-purple/20');
                } else {
                    btn.classList.remove('border-neon-purple', 'bg-neon-purple/20');
                    btn.classList.add('border-neon-blue/30');
                }
            });

            // Show common fields
            document.querySelector('.common-fields').style.display = 'block';
            
            // Hide all specific fields first
            document.querySelectorAll('#twitterFields, #telegramFields, #youtubeFields, #dailyFields, #manualFields').forEach(el => {
                el.classList.add('hidden');
            });

            // Show relevant fields
            if (type === 'twitter') {
                document.getElementById('twitterFields').classList.remove('hidden');
                document.getElementById('taskPlatform').value = 'twitter';
                document.getElementById('taskType').value = 'social';
                // Setup Twitter action type change handler
                document.getElementById('twitterActionType').onchange = updateTwitterFields;
                updateTwitterFields();
            } else if (type === 'telegram') {
                document.getElementById('telegramFields').classList.remove('hidden');
                document.getElementById('taskPlatform').value = 'telegram';
                document.getElementById('taskType').value = 'social';
            } else if (type === 'youtube') {
                document.getElementById('youtubeFields').classList.remove('hidden');
                document.getElementById('taskPlatform').value = 'youtube';
                document.getElementById('taskType').value = 'content';
            } else if (type === 'daily') {
                document.getElementById('dailyFields').classList.remove('hidden');
                document.getElementById('taskPlatform').value = 'daily';
                document.getElementById('taskType').value = 'engagement';
            } else if (type === 'manual') {
                document.getElementById('manualFields').classList.remove('hidden');
                document.getElementById('taskPlatform').value = 'manual';
                document.getElementById('taskType').value = 'engagement';
            }

            // Show submit button
            document.getElementById('submitQuestBtn').classList.remove('hidden');
        }

        function updateTwitterFields() {
            const actionType = document.getElementById('twitterActionType').value;
            const tweetField = document.getElementById('twitterTweetField');
            const usernameField = document.getElementById('twitterUsernameField');

            if (actionType === 'follow') {
                usernameField.style.display = 'block';
                tweetField.classList.add('hidden');
            } else {
                usernameField.style.display = 'block';
                tweetField.classList.remove('hidden');
            }
        }
        
        function toggleYouTubeVerification() {
            const platform = document.getElementById('taskPlatform').value;
            const verificationSection = document.getElementById('youtubeVerification');
            
            if (platform === 'youtube') {
                verificationSection.classList.remove('hidden');
            } else {
                verificationSection.classList.add('hidden');
            }
        }

        function showAddRewardModal() {
            document.getElementById('rewardModal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Check if already logged in
        window.onload = async function() {
            const token = localStorage.getItem('authToken');
            if (token) {
                authToken = token;
                
                // Validate token by making a test API call
                try {
                    const response = await fetch(`${API_URL}/tasks`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    
                    if (response.ok) {
                        // Token is valid
                        document.getElementById('loginScreen').classList.add('hidden');
                        document.getElementById('adminDashboard').classList.remove('hidden');
                        loadDashboard();
                    } else if (response.status === 401) {
                        // Token expired or invalid
                        handleAuthError();
                    }
                } catch (error) {
                    console.error('Token validation failed:', error);
                    // Clear invalid token
                    localStorage.removeItem('authToken');
                    authToken = null;
                }
            }
        };
    </script>
    <script src="https://unpkg.com/flowbite@1.7.0/dist/flowbite.js"></script>
</body>
</html>
